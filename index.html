<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Thoughts In Silico</title>
  <link rel="stylesheet" href="css/style.css" />
  <meta name="theme-color" content="#000000" />
  <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$','$$'], ['\\[','\\]']] }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body class="home">
  <header class="site-header container">
    <a class="site-title" href="index.html">Thoughts In Silico</a>
    <nav class="site-nav" aria-label="Primary">
      <a href="categories.html?cat=Book%20Reviews">Book Reviews</a>
      <div class="nav-dropdown">
        <a href="categories.html?cat=Fiction">Fiction ▾</a>
        <div class="nav-submenu nav-submenu--row">
          <a href="categories.html?cat=Fiction&sub=Short%20Stories">Short Stories</a>
          <a href="categories.html?cat=Fiction&sub=Poetry">Poetry</a>
        </div>
      </div>
      <a href="categories.html?cat=Mathematics">Mathematics</a>
      <a href="categories.html?cat=Technology">Technology</a>
      <a href="categories.html?cat=Music">Music</a>
      <a href="categories.html?cat=Miscellaneous">Miscellaneous</a>
      <a href="about.html">About</a>
    </nav>
  </header>

  <!-- Anthems (only thing above the one-screen scroll posts) -->
  <section class="anthems-hero container">
    <div class="inner">
      <article class="anthem-card" id="anthems">
        <h3 class="feature-title">Anthems</h3>
        <div class="anthems-list" id="anthems-list"><!-- populated by JS --></div>
        <audio id="anthem-audio" preload="none"></audio>
      </article>
    </div>
  </section>

  <!-- Posts and the rest start after one full screen -->
  <main class="container home-posts">
    <h2 class="list-heading">Recent posts</h2>
    <div id="posts-grid" class="posts-grid" aria-live="polite"></div>

    <section class="home-features" aria-label="Personal updates">
      <article class="feature-card">
        <h3 class="feature-title">Quote of the week</h3>
        <blockquote class="feature-quote"></blockquote>
      </article>

      <article class="feature-card">
        <h3 class="feature-title">What I’m up to</h3>
        <div class="feature-body"></div>
      </article>
    </section>
  </main>

  <footer class="site-footer container">
    <p><small>© 2025 Thoughts In Silico.</small></p>
  </footer>

  <!-- Typewriter for the site title -->
  <script>
    (function(){
      const el = document.querySelector('.site-title');
      const txt = el.textContent.trim();
      el.textContent = "";
      el.classList.add('typer');
      let i = 0;
      const id = setInterval(()=>{
        el.textContent = txt.slice(0, ++i);
        if(i >= txt.length){
          clearInterval(id);
          el.classList.add('caret-done');
        }
      }, 55);
    })();
  </script>

  <!-- Render “Recent posts” -->
  <script>
    (async function(){
      const grid = document.getElementById('posts-grid');
      try{
        const res = await fetch('posts/posts.json'); /* correct path */
        let posts = await res.json();
        posts = posts.sort((a,b) => new Date(b.date) - new Date(a.date));

        grid.innerHTML = posts.map(p => `
          <article class="post-card reveal-card">
            <h3 class="post-title"><a href="${p.url}">${p.titleHtml || p.title}</a></h3>
            <time class="post-time" datetime="${p.date}">
              ${new Date(p.date).toLocaleString(undefined,{month:'short',year:'numeric'})}
            </time>
            <p class="post-meta">
              ${p.category}${p.subcategory ? ' • ' + p.subcategory : ''}
            </p>
          </article>
        `).join('');

        if (window.MathJax?.typeset) MathJax.typeset();
      } catch (e) {
        console.error(e);
        grid.innerHTML = '<p class="muted">Could not load posts.</p>';
      }
    })();
  </script>

  <!-- Reveal animation hookup -->
  <script>
    (function(){
      const obs = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{
          if(e.isIntersecting){
            e.target.classList.add('is-visible');
            obs.unobserve(e.target);
          }
        });
      }, { threshold: 0.12 });

      const start = () =>
        document.querySelectorAll('.reveal-card').forEach(el => obs.observe(el));

      const mo = new MutationObserver(start);
      mo.observe(document.getElementById('posts-grid'), { childList: true });
      start();
    })();
  </script>

  <!-- Anthems logic -->
  <script>
    (function(){
      // Change the list to your own tracks (files live in /audio).
      const ANTHEMS = [
        { title: "Allegra (solo sketch)",  src: "audio/anthem1.mp3" },
        { title: "Third Stream Study in D",src: "audio/anthem2.mp3" },
        { title: "Nocturne for Two Tenors",src: "audio/anthem3.mp3" }
      ];

      const list  = document.getElementById('anthems-list');
      const audio = document.getElementById('anthem-audio');

      list.innerHTML = ANTHEMS.map((a,i)=>`
        <div class="anthem-item" data-i="${i}">
          <button class="anthem-btn" type="button">Play me</button>
          <span class="anthem-title" aria-live="polite">${a.title}</span>
        </div>
      `).join('');

      let current = -1;

      function showTitle(i){
        document.querySelectorAll('.anthem-title').forEach(t => t.classList.remove('show','now-playing'));
        if(i>=0){
          const t = list.querySelector(\`.anthem-item[data-i="\${i}"] .anthem-title\`);
          t.classList.add('show','now-playing');
        }
      }

      list.addEventListener('click', (e)=>{
        const btn = e.target.closest('.anthem-btn');
        if(!btn) return;
        const item = e.target.closest('.anthem-item');
        const i = +item.dataset.i;

        if(i === current && !audio.paused){ audio.pause(); return; }

        current = i;
        audio.src = ANTHEMS[i].src;
        audio.play().catch(console.error);
        showTitle(i);
      });

      audio.addEventListener('ended', ()=>{ showTitle(-1); current = -1; });
    })();
  </script>
</body>
</html>
