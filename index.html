<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Silico: Book of Genesis</title>
  <link rel="stylesheet" href="css/style.css" />
  <meta name="theme-color" content="#000000" />
  <script>
    window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$','$$'], ['\\[','\\]']] } };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body class="home">
  <div class="layout">
    <!-- Sidebar include -->
    <div id="sidebar-include" data-src="partials/sidebar.html"></div>

    <!-- Main -->
    <main class="main">
      <section class="hero" aria-label="Background art"></section>

      <section class="container section">
        <h1 class="site-title" style="font-size: clamp(28px,5vw,46px);">Recent Posts</h1>
        <hr class="hr-dots"/>
        <div id="posts-grid" class="posts-grid" aria-live="polite"></div>

        <!-- Kept exactly: Trvthnukes & Virtual Histories -->
        <article class="feature-card" style="margin-top:16px">
          <h3 class="roman" style="margin:0 0 6px">Trvthnukes</h3>
          <hr class="hr-dots" />
          <blockquote id="trvthnuke" class="post-body" style="margin:0"></blockquote>
        </article>

        <article class="feature-card" style="margin-top:12px">
          <h3 class="roman" style="margin:0 0 6px">Virtual Histories</h3>
          <hr class="hr-dots" />
          <div id="virtual-history" class="post-body"></div>
        </article>
      </section>

      <footer class="container" style="padding:18px 0 30px">
        <p><small>© <span id="y"></span> Silico: Book of Genesis.</small></p>
      </footer>
    </main>
  </div>

  <script>
    // Sidebar include + active link
    (async function(){
      const holder = document.getElementById('sidebar-include');
      if (holder){
        const res = await fetch(holder.dataset.src || 'partials/sidebar.html');
        holder.outerHTML = await res.text();
        // highlight current page
        const path = (location.pathname.split('/').pop() || 'index.html');
        document.querySelectorAll('.sidebar nav a').forEach(a=>{
          const href = a.getAttribute('href') || '';
          if (href === path || href.startsWith(path+'?')) a.setAttribute('aria-current','page');
        });
      }
    })();

    document.getElementById('y').textContent = new Date().getFullYear();

    // Load & render posts (NEWEST → OLDEST)
    (async function(){
      const grid = document.getElementById('posts-grid');
      try{
        const res = await fetch('posts/posts.json');
        const posts = await res.json();

        posts.sort((a,b)=> new Date(b.date) - new Date(a.date));

        const fmt = iso => new Date(iso).toLocaleDateString(undefined,{year:'numeric', month:'short', day:'numeric'});
        grid.innerHTML = posts.slice(0, 9).map(p => `
          <article class="post-card">
            <h3><a href="${p.url}">${p.titleHtml || p.title}</a></h3>
            <time class="post-time" datetime="${p.date}">${fmt(p.date)}</time>
            <p class="post-meta">${p.category}${p.subcategory ? ' • ' + p.subcategory : ''}</p>
            ${p.excerpt ? `<p class="post-body">${p.excerpt}</p>` : ''}
          </article>
        `).join('');

        grid.querySelectorAll('.post-card a').forEach(a=>{
          const raw = a.getAttribute('href');
          a.setAttribute('href', `post.html?u=${encodeURIComponent(raw)}`);
        });

        if (window.MathJax?.typeset) MathJax.typeset();
      }catch(e){
        grid.innerHTML = '<p class="post-body" style="color:#cfcac3">Could not load posts.</p>';
      }
    })();
  </script>
</body>
</html>
