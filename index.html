<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Thoughts In Silico</title>
  <link rel="stylesheet" href="css/style.css" />
  <meta name="theme-color" content="#000000" />
  <script>
    /* MathJax stays available site-wide */
    window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$','$$'], ['\\[','\\]']] } };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body class="home">
  <header class="site-header container">
    <a class="site-title" href="index.html">Thoughts In Silico</a>
    <nav class="site-nav" aria-label="Primary">
      <a href="about.html">About</a>
      <a href="categories.html?cat=Book%20Reviews">Book Reviews</a>
      <div class="nav-dropdown">
        <a href="categories.html?cat=Fiction">Fiction ▾</a>
        <div class="nav-submenu nav-submenu--row">
          <a href="categories.html?cat=Fiction&sub=Short%20Stories">Short Stories</a>
          <a href="categories.html?cat=Fiction&sub=Poetry">Poetry</a>
        </div>
      </div>
      <a href="categories.html?cat=Mathematics">Mathematics</a>
      <a href="categories.html?cat=Technology">Technology</a>
      <a href="categories.html?cat=Music">Music</a>
      <a href="categories.html?cat=Miscellaneous">Miscellaneous</a>
    </nav>
  </header>

  <!-- ONE plane + ONE dotted trace (fluid, airy curve) -->
  <div class="flight-layer" aria-hidden="true">
    <!-- Dotted trace -->
    <svg class="flight-trace" viewBox="0 0 1000 1600" preserveAspectRatio="none">
      <path id="tsiFlightPath"
            d="M 40 120 
               C 260 40, 520 140, 760 70 
               S 940 170, 820 220
               C 700 270, 560 260, 580 330
               C 600 400, 760 420, 860 360
               C 940 310, 880 260, 820 260
               C 700 260, 620 360, 560 460
               C 500 560, 520 660, 600 740
               C 680 820, 780 860, 860 920
               C 920 970, 900 1050, 820 1100
               C 700 1180, 520 1180, 420 1260
               C 320 1340, 320 1440, 420 1520" />
    </svg>

    <!-- Plane (solid milky color, slightly larger) -->
    <div class="flight-hint" id="flightPlane">
      <svg viewBox="0 0 64 64" aria-hidden="true">
        <!-- crisp paper airplane -->
        <path d="M4 30L60 6 28 36" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linejoin="round"/>
        <path d="M28 36l4 20 6-14 22-36" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linejoin="round"/>
      </svg>
    </div>
  </div>

  <!-- POSTS SECTION (starts one full viewport below; CSS adds margin-top: 100vh) -->
  <main class="container home-posts">
    <h2 class="list-heading">Recent posts</h2>
    <div id="posts-grid" class="posts-grid" aria-live="polite"></div>

    <!-- Solid, larger personal boxes BELOW the posts (you fill them) -->
    <section class="home-features" aria-label="Personal updates">
      <article class="feature-card">
        <h3 class="feature-title">Quote of the week</h3>
        <blockquote class="feature-quote"></blockquote>
      </article>

      <article class="feature-card">
        <h3 class="feature-title">What I’m up to</h3>
        <div class="feature-body"></div>
      </article>
    </section>
  </main>

  <footer class="site-footer container">
    <p><small>© 2025 Thoughts In Silico.</small></p>
  </footer>

  <!-- Typed site title (layout is fixed; no shifting) -->
  <script>
    (function(){
      const el = document.querySelector('.site-title');
      const txt = el.textContent.trim();
      el.textContent = "";
      el.classList.add('typer');
      let i=0; const id=setInterval(()=>{
        el.textContent = txt.slice(0, ++i);
        if(i>=txt.length){ clearInterval(id); el.classList.add('caret-done'); }
      }, 55);
    })();
  </script>

  <!-- Render posts (newest first) -->
  <script>
    (async function renderHome(){
      const grid = document.getElementById('posts-grid');
      try{
        const res = await fetch('posts/posts.json');
        let posts = await res.json();
        posts = posts.sort((a,b)=> new Date(b.date) - new Date(a.date));
        grid.innerHTML = posts.map(p => `
          <article class="post-card reveal-card">
            <h3 class="post-title"><a href="${p.url}">${p.titleHtml || p.title}</a></h3>
            <time class="post-time" datetime="${p.date}">${new Date(p.date).toLocaleString(undefined,{month:'short',year:'numeric'})}</time>
            <p class="post-meta">${p.category}${p.subcategory ? ' • ' + p.subcategory : ''}</p>
          </article>
        `).join('');
        if (window.MathJax?.typeset) MathJax.typeset();
      }catch(e){
        console.error(e);
        grid.innerHTML = '<p class="muted">Could not load posts.</p>';
      }
    })();
  </script>

  <!-- Reveal on scroll + plane behavior -->
  <script>
    (function(){
      /* Reveal cards */
      const obs = new IntersectionObserver((es)=>es.forEach(e=>{
        if(e.isIntersecting){ e.target.classList.add('is-visible'); obs.unobserve(e.target); }
      }),{threshold:0.12});
      const start = ()=> document.querySelectorAll('.reveal-card').forEach(el=>obs.observe(el));
      const mo = new MutationObserver(start);
      mo.observe(document.getElementById('posts-grid'), {childList:true});
      start();

      /* Plane follows the same SVG path via CSS motion path */
      const path = document.getElementById('tsiFlightPath');
      const plane = document.getElementById('flightPlane');
      if(path && plane){
        const d = path.getAttribute('d');
        document.documentElement.style.setProperty('--flight-path', `path("${d}")`);
      }

      /* Fade out plane + trace only when near bottom */
      const thresh = 60; // px from bottom
      const onScroll = () => {
        const atBottom = window.innerHeight + window.scrollY >= (document.documentElement.scrollHeight - thresh);
        document.body.classList.toggle('flight-done', atBottom);
      };
      window.addEventListener('scroll', onScroll, {passive:true});
      onScroll();

      /* Click plane nudges one screen down (optional) */
      plane?.addEventListener('click', () => window.scrollBy({top: window.innerHeight * 0.9, behavior: 'smooth'}));

      /* Pause animations when tab not visible */
      document.addEventListener('visibilitychange', () => {
        const paused = document.hidden ? 'paused' : 'running';
        plane?.style && (plane.style.animationPlayState = paused);
        path && (path.style.animationPlayState = paused);
      });
    })();
  </script>
</body>
</html>
