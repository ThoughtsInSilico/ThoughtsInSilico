<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Categories • Thoughts In Silico</title>
  <link rel="stylesheet" href="css/style.css" />
  <meta name="theme-color" content="#000000" />
  <script>
    window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] } };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
  <header class="site-header container">
    <a class="site-title" href="index.html">Thoughts In Silico</a>
    <nav class="site-nav" aria-label="Primary">
      <a href="categories.html?cat=Book%20Reviews">Book Reviews</a>

      <div class="nav-dropdown">
        <a href="categories.html?cat=Fiction">Fiction ▾</a>
        <div class="nav-submenu nav-submenu--row">
          <a href="categories.html?cat=Fiction&sub=Short%20Stories">Short Stories</a>
          <a href="categories.html?cat=Fiction&sub=Poetry">Poetry</a>
        </div>
      </div>

      <a href="categories.html?cat=Mathematics">Mathematics</a>
      <a href="categories.html?cat=Technology">Technology</a>
      <a href="categories.html?cat=Music">Music</a>
      <a href="categories.html?cat=Miscellaneous">Miscellaneous</a>
    </nav>
  </header>

  <main class="container posts-wrap">
    <h1 id="cat-title">Posts</h1>
    <div id="posts-grid" class="posts-grid"></div>
  </main>

  <footer class="site-footer container">
    <p><small>© 2025 Thoughts In Silico.</small></p>
  </footer>

  <script>
    function getParams(){
      const u = new URL(location.href);
      return Object.fromEntries(u.searchParams.entries());
    }
    function titleCase(s){ return s ? s.replace(/%20/g,' ').replace(/\+/g,' ').replace(/\s+/g,' ').trim() : ''; }
    async function renderCategory(){
      const {cat, sub} = getParams();
      const title = document.getElementById('cat-title');
      const grid = document.getElementById('posts-grid');
      const catText = titleCase(cat)||'All';
      const subText = titleCase(sub)||'';
      title.textContent = subText ? `${catText} • ${subText}` : catText;
      try{
        const res = await fetch('posts/posts.json');
        const posts = await res.json();
        const filtered = posts.filter(p => (!cat || p.category===catText) && (!sub || p.subcategory===subText));
        grid.innerHTML = filtered.map(p => `
          <article class="post-card">
            <h3 class="post-title"><a href="${p.url}">${p.titleHtml || p.title}</a></h3>
            <time class="post-time" datetime="${p.date}">${new Date(p.date).toLocaleString(undefined,{month:'short', year:'numeric'})}</time>
            <p class="post-meta">${p.category}${p.subcategory ? ' • ' + p.subcategory : ''}</p>
          </article>
        `).join('') || '<p class="muted">No posts yet.</p>';
        if (window.MathJax?.typeset) MathJax.typeset();
      }catch(e){
        console.error(e);
        grid.innerHTML = '<p class="muted">Could not load posts.</p>';
      }
    }
    renderCategory();
  </script>
</body>
</html>
