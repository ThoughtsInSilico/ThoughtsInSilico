<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Categories • Silico: Book of Genesis</title>
  <link rel="stylesheet" href="css/style.css" />
  <meta name="theme-color" content="#000000" />
  <script>
    window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$','$$'], ['\\[','\\]']] } };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <div class="layout">
    <aside class="sidebar" role="navigation" aria-label="Primary">
      <div class="brand"><a class="site-title" href="index.html">Silico: Book of Genesis</a></div>
      <nav>
        <h3>Pages</h3>
        <ul>
          <li><a href="about.html">The Brain-vat Speaks</a></li>
          <li><a href="categories.html?cat=Book%20Reviews">Book Reviews</a></li>
          <li>
            <a href="#" class="nav-toggle" aria-expanded="false">Fiction ▾</a>
            <ul class="nav-submenu" aria-label="Fiction submenu">
              <li><a href="categories.html?cat=Fiction&sub=Short%20Stories">Short Stories</a></li>
              <li><a href="categories.html?cat=Fiction&sub=Poetry">Poetry</a></li>
            </ul>
          </li>
          <li><a href="categories.html?cat=Mathematics">Mathematics</a></li>
          <li><a href="categories.html?cat=Technology">Technognostics</a></li>
          <li><a href="categories.html?cat=Music">Music</a></li>
          <li><a href="library.html">My Library</a></li>
          <li><a href="categories.html?cat=Miscellaneous">Miscellaneous</a></li>
        </ul>

        <h3>Anthems</h3>
        <article class="anthem-card">
          <div class="anthems-list">
            <div class="anthem-item"><button class="anthem-btn" type="button" disabled>Play</button> Add tracks in audio/…</div>
          </div>
          <audio preload="none"></audio>
        </article>
      </nav>
    </aside>

    <main class="main">
      <section class="container section">
        <h1 class="site-title" id="catTitle" style="font-size: clamp(28px,5vw,46px);">Categories</h1>
        <hr class="hr-dots"/>
        <div id="posts" class="posts-grid" aria-live="polite"></div>
      </section>

      <footer class="container" style="padding:18px 0 30px">
        <small>© <span id="y"></span> Silico: Book of Genesis</small>
      </footer>
    </main>
  </div>

  <script>
    // Expand/collapse submenu (mobile)
    document.querySelectorAll('.nav-toggle').forEach(t => {
      t.addEventListener('click', e => {
        e.preventDefault();
        const ul = t.nextElementSibling;
        const open = ul.classList.toggle('open');
        t.setAttribute('aria-expanded', String(open));
      });
    });

    function retargetPostLinks(root){
      root.querySelectorAll('a[href^="posts/"]').forEach(a=>{
        a.href = 'post.html?u=' + encodeURIComponent(a.getAttribute('href'));
      });
    }

    async function loadCategory(){
      const grid = document.getElementById('posts');
      const h = document.getElementById('catTitle');
      const usp = new URLSearchParams(location.search);
      const cat = usp.get('cat') || 'All';
      const sub = usp.get('sub') || '';
      h.innerHTML = (sub ? `${cat} • <span style="opacity:.7">${sub}</span>` : cat);

      try{
        const res = await fetch('posts/posts.json');
        const posts = await res.json();
        const filter = p => (cat==='All' || p.category===cat) && (!sub || p.subcategory===sub);
        const formatDate = (iso) => {
          const d = new Date(iso);
          return d.toLocaleDateString(undefined,{year:'numeric', month:'short', day:'numeric'});
        };

        grid.innerHTML = posts.filter(filter).map(p => `
          <article class="post-card">
            <h3><a href="${p.url}">${p.titleHtml || p.title}</a></h3>
            <time class="post-time" datetime="${p.date}">${formatDate(p.date)}</time>
            <p class="post-meta">${p.category}${p.subcategory ? ' • ' + p.subcategory : ''}</p>
          </article>
        `).join('') || '<p class="post-body" style="color:#cfcac3">No posts yet.</p>';

        retargetPostLinks(grid);
        if (window.MathJax?.typeset) MathJax.typeset();
      }catch(e){
        grid.innerHTML = '<p class="post-body" style="color:#cfcac3">Could not load posts.</p>';
      }
    }

    document.getElementById('y').textContent = new Date().getFullYear();
    loadCategory();
  </script>
</body>
</html>
